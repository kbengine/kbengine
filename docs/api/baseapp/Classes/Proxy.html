<html>
<head>
<title>Proxy - KBEngine base 文档</title>
<link href="../../style.css" rel="stylesheet" type="text/css">
</head>
<body>
<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tr><td align=left style="background:#0F5286"> <img src="../../logo.png"> </td></tr>
</table> <hr>
<h1>类 Proxy</h1>
<p style="text-align: center;"><span class="module_h1">[<a href="../Modules/KBEngine.html" class="module_h1">模块KBEngine</a>]</span></p><p>Proxy是<a href="../Modules/KBEngine.html">KBEngine</a>模块的一部分。 <a href="#detailed_description">更多...</a></p><p></p><pre>import KBEngine</pre>
<h2>父类</h2>
<a href="Base.html">Base</a>
<br>

<h2><a href="#" onClick="obj=document.getElementById( 'functions' );vis = (obj.style.display == 'none') ? 'block' : 'none'; obj.style.display = vis; return false;" class="h2">成员函数</a></h2>
<table id="functions" cellpadding=0 cellspacing=3 style="margin-left: 20px;">

<tr><td>
<span class="function_list">def <a href="#getClientType" class="function_list" >getClientType</a>( self ):</span>
</td></tr>

<tr><td>
<span class="function_list">def <a href="#giveClientTo" class="function_list" >giveClientTo</a>( self, proxy ):</span>
</td></tr>

<tr><td>
<span class="function_list">def <a href="#streamFileToClient" class="function_list" >streamFileToClient</a>( self, resourceName, desc="", id=-1 ):</span>
</td></tr>

<tr><td>
<span class="function_list">def <a href="#streamStringToClient" class="function_list" >streamStringToClient</a>( self, data, desc="", id=-1 ):</span>
</td></tr>

</table>

<h2><a href="#" onClick="obj=document.getElementById( 'callbacks' );vis = (obj.style.display == 'none') ? 'block' : 'none'; obj.style.display = vis; return false;" class="h2">回调函数</a></h2>
<table id="callbacks" cellpadding=0 cellspacing=3 style="margin-left: 20px;">

<tr><td>
<span class="function_list">def <a href="#clientDead" class="function_list" >clientDead</a>( self ):</span>
</td></tr>

<tr><td>
<span class="function_list">def <a href="#onClientDeath" class="function_list" >onClientDeath</a>( self ):</span>
</td></tr>

<tr><td>
<span class="function_list">def <a href="#onClientGetCell" class="function_list" >onClientGetCell</a>( self ):</span>
</td></tr>

<tr><td>
<span class="function_list">def <a href="#onEntitiesEnabled" class="function_list" >onEntitiesEnabled</a>( self ):</span>
</td></tr>

<tr><td>
<span class="function_list">def <a href="#onGiveClientToFailure" class="function_list" >onGiveClientToFailure</a>( self ):</span>
</td></tr>

<tr><td>
<span class="function_list">def <a href="#onLatencyTrigger" class="function_list" >onLatencyTrigger</a>( self, latency, goneAboveThis ):</span>
</td></tr>

<tr><td>
<span class="function_list">def <a href="#onLogOnAttempt" class="function_list" >onLogOnAttempt</a>( self, ip, port, password ):</span>
</td></tr>

<tr><td>
<span class="function_list">def <a href="#onStreamComplete" class="function_list" >onStreamComplete</a>( self, id, success ):</span>
</td></tr>

</table>

<h2><a href="#" onClick="obj=document.getElementById( 'attributes' );vis = (obj.style.display == 'none') ? 'block' : 'none'; obj.style.display = vis; return false;" class="h2">属性</a></h2>
<table id="attributes" cellpadding=0 cellspacing=3 style="margin-left: 20px;">

<tr valign=top><td><a href="#__account_name__" class="attribute_list" >__account_name__</a></td><td>&nbsp; </td></tr>

<tr valign=top><td><a href="#clientAddr" class="attribute_list" >clientAddr</a></td><td>&nbsp; </td></tr>

<tr valign=top><td><a href="#entitiesEnabled" class="attribute_list" >entitiesEnabled</a></td><td>&nbsp; </td></tr>

<tr valign=top><td><a href="#hasClient" class="attribute_list" >hasClient</a></td><td>&nbsp; </td></tr>

<tr valign=top><td><a href="#roundTripTime" class="attribute_list" >roundTripTime</a></td><td>&nbsp; </td></tr>

<tr valign=top><td><a href="#timeSinceHeardFromClient" class="attribute_list" >timeSinceHeardFromClient</a></td><td>&nbsp; </td></tr>

</table>

<hr>
<a name="detailed_description"></a><h2>详细描述</h2>
<a href="Proxy.html">Proxy</a>是<a href="Base.html">Base</a>的一个特殊类型，它有一个关联的客户端。本身来说，
它操控所有服务端向客户端的更新。不能在脚本直接创建<a href="Proxy.html">Proxy</a>类对象。

<hr>
<h2>成员函数文档</h2>

<a name="getClientType"></a><p class="function_definition">
<span class="function_definition">def getClientType( <i>self</i> ):</span>
</p>

<div class="function_description">
<b>功能说明：</b><br><br>
这个函数返回客户端类型。
</div>

<p>
<span class="function_return">返回:</span>
<table border=0 cellpadding=0 cellspacing=3 style="margin-left: 20px;">
<tr><td>
UNKNOWN_CLIENT_COMPONENT_TYPE	= 0,<br/>
CLIENT_TYPE_MOBILE				= 1,	// 手机类<br/>
CLIENT_TYPE_PC					= 2,	// pc， 一般都是exe客户端<br/>
CLIENT_TYPE_BROWSER				= 3,	// web应用， html5，flash<br/>
CLIENT_TYPE_BOTS				= 4,	// bots<br/>
CLIENT_TYPE_END					= 5		// end<br/>
</td></tr>
</table>
</p>

<a name="giveClientTo"></a><p class="function_definition">
<span class="function_definition">def giveClientTo( <i>self, proxy</i> ):</span>
</p>

<div class="function_description">
<b>功能说明：</b><br><br>
这个函数传输这个proxy关联的客户端给另外一个proxy。当前的proxy必须有一个客户端
而目标proxy则不必须有。
</div>

<p>
<span class="function_links"><b>参看：</b></span>
<table border=0 cellpadding=0 cellspacing=3 style="margin-left: 20px;">
<tr><td><a href="Proxy.html">Proxy</a>.<a href="Proxy.html#onGiveClientToFailure">onGiveClientToFailure</a><br></td></tr>
</table>
</p>

<p>
<span class="function_parameter">参数：</span>
<table border=0 cellpadding=0 cellspacing=3 style="margin-left: 20px;">

<tr valign=top><td><span class="function_parameter_name"><i>proxy</i></span></td><td><span class="function_parameter_description">
传输客户端到的proxy。
</span></td></tr>

</table>
</p>

<a name="streamFileToClient"></a><p class="function_definition">
<span class="function_definition">def streamFileToClient( <i>self, resourceName, desc="", id=-1</i> ):</span>
</p>

<div class="function_description">
<b>功能说明：</b><br><br>
这个函数类似于streamStringToClient()，与之不同的是第一个字符串参数是一个
要发送给客户端的文件路径，而不是数据本身。这个应该用于当数据全部从磁盘里
读出时发送给客户端，所有文件在不同的线程上操作，因此不会危及主线程。
</div>

<p>
<span class="function_links"><b>参看：</b></span>
<table border=0 cellpadding=0 cellspacing=3 style="margin-left: 20px;">
<tr><td><a href="Proxy.html">Proxy</a>.<a href="Proxy.html#onStreamComplete">onStreamComplete</a><br></td></tr>
</table>
</p>

<p>
<span class="function_parameter">参数：</span>
<table border=0 cellpadding=0 cellspacing=3 style="margin-left: 20px;">

<tr valign=top><td><span class="function_parameter_name"><i>resourceName</i></span></td><td><span class="function_parameter_description">
要发送的资源名称。
</span></td></tr>

<tr valign=top><td><span class="function_parameter_name"><i>desc</i></span></td><td><span class="function_parameter_description">
一个可选的字符串，发送给客户端的描述。
</span></td></tr>

<tr valign=top><td><span class="function_parameter_name"><i>id</i></span></td><td><span class="function_parameter_description">
一个16位的id，它的值完全取决于调用者。如果传入-1系统将会在队列里面选择一个没有在用的id。
</span></td></tr>

</table>
</p>

<p>
<span class="function_return">返回：</span>
<table border=0 cellpadding=0 cellspacing=3 style="margin-left: 20px;">
<tr><td>
与这个下载关联的id。
</td></tr>
</table>
</p>

<a name="streamStringToClient"></a><p class="function_definition">
<span class="function_definition">def streamStringToClient( <i>self, data, desc="", id=-1</i> ):</span>
</p>

<div class="function_description">
<b>功能说明：</b><br><br>
这个函数发送一些数据到当前依附它的客户端。如果客户端是分离的则数据被清除，
当客户端依附的时候才可调用这个函数。16位的id完全取决于调用者。如果调用者没有指定
这个ID则系统会分配一个未用过的id。
<br><br>
你可以在Proxy的派生类中定义回调函数（onStreamComplete），所有数据发送成功给
客户端时，或下载失败时会调用这个回调函数。
<br><br>
参看base Python API文档的<a href="Proxy.html">Proxy</a>.<a href=Proxy.html#onStreamComplete>onStreamComplete</a>，
和client Python API文档的<a href="BWPersonality.html">BWPersonality</a>.<a href=BWPersonality.html#onStreamComplete>onStreamComplete</a>。
</div>

<p>
<span class="function_parameter">参数：</span>
<table border=0 cellpadding=0 cellspacing=3 style="margin-left: 20px;">

<tr valign=top><td><span class="function_parameter_name"><i>data</i></span></td><td><span class="function_parameter_description">
要发送的字符串。
</span></td></tr>

<tr valign=top><td><span class="function_parameter_name"><i>desc</i></span></td><td><span class="function_parameter_description">
一个可选的字符串，发送给客户端的描述。
</span></td></tr>

<tr valign=top><td><span class="function_parameter_name"><i>id</i></span></td><td><span class="function_parameter_description">
一个16位的id，它的值完全取决于调用者。如果传入-1系统将会在队列里面选择一个没有在用的id。
</span></td></tr>

</table>
</p>

<p>
<span class="function_return">返回：</span>
<table border=0 cellpadding=0 cellspacing=3 style="margin-left: 20px;">
<tr><td>
与这个下载关联的id。
</td></tr>
</table>
</p>

<hr>
<h2>回调函数文档</h2>

<a name="clientDead"></a><p class="function_definition">
<span class="function_definition">def clientDead( <i>self</i> ):</span>
</p>

<div class="function_description">This callback method is obsolete. It is replaced by onClientDeath.
</div>

<a name="onClientDeath"></a><p class="function_definition">
<span class="function_definition">def onClientDeath( <i>self</i> ):</span>
</p>

<div class="function_description">If present, this method is called when it has been detected that the
associated client has disconnected. This method has no arguments.
</div>

<a name="onClientGetCell"></a><p class="function_definition">
<span class="function_definition">def onClientGetCell( <i>self</i> ):</span>
</p>

<div class="function_description">If present, this method is called when the message to the client that it now
has a cell is called.
</div>

<a name="onEntitiesEnabled"></a><p class="function_definition">
<span class="function_definition">def onEntitiesEnabled( <i>self</i> ):</span>
</p>

<div class="function_description">If present, this method is called when the client requests that updates
from the cell be enabled. This method has no arguments.
</div>

<a name="onGiveClientToFailure"></a><p class="function_definition">
<span class="function_definition">def onGiveClientToFailure( <i>self</i> ):</span>
</p>

<div class="function_description">This is called if giveClientTo has been called for a remote proxy that could
not accept this client connection. For example if it already has a client
connected.
</div>

<a name="onLatencyTrigger"></a><p class="function_definition">
<span class="function_definition">def onLatencyTrigger( <i>self, latency, goneAboveThis</i> ):</span>
</p>

<div class="function_description">This method is called when the latency associated with the channel to this
proxy's client, crosses a threshold in the latencyTriggers attribute. To
check the current latency use <a href="Proxy.html">Proxy</a>.<a href=Proxy.html#roundTripTime>roundTripTime</a> or
<a href="Proxy.html">Proxy</a>.<a href=Proxy.html#timeSinceHeardFromClient>timeSinceHeardFromClient</a>.
</div>

<p>
<span class="function_parameter">参数：</span>
<table border=0 cellpadding=0 cellspacing=3 style="margin-left: 20px;">

<tr valign=top><td><span class="function_parameter_name"><i>latency</i></span></td><td><span class="function_parameter_description">&nbsp;The latency trigger value.
</span></td></tr>

<tr valign=top><td><span class="function_parameter_name"><i>goneAboveThis</i></span></td><td><span class="function_parameter_description">&nbsp;Indicates whether the latency has gone above or
	below this.
</span></td></tr>

</table>
</p>

<a name="onLogOnAttempt"></a><p class="function_definition">
<span class="function_definition">def onLogOnAttempt( <i>self, ip, port, password</i> ):</span>
</p>

<div class="function_description">If present, this method is called if a client attempts to log in and wants
to use this entity.
<br><br>
This callback should return one of the following: <a href="../Modules/KBEngine.html">KBEngine</a>.<a href=KBEngine.html#LOG_ON_ACCEPT>LOG_ON_ACCEPT</a>,
<a href="../Modules/KBEngine.html">KBEngine</a>.<a href=KBEngine.html#LOG_ON_REJECT>LOG_ON_REJECT</a>, <a href="../Modules/KBEngine.html">KBEngine</a>.<a href=KBEngine.html#LOG_ON_WAIT_FOR_DESTROY>LOG_ON_WAIT_FOR_DESTROY</a>.
<br><br>
If this callback returns <a href="../Modules/KBEngine.html">KBEngine</a>.<a href=KBEngine.html#LOG_ON_REJECT>LOG_ON_REJECT</a>, the log on attempt fails.
<br><br>
If this callback returns <a href="../Modules/KBEngine.html">KBEngine</a>.<a href=KBEngine.html#LOG_ON_ACCEPT>LOG_ON_ACCEPT</a>, the client is attached to
this active entity.
<br><br>
If this callback returns <a href="../Modules/KBEngine.html">KBEngine</a>.<a href=KBEngine.html#LOG_ON_WAIT_FOR_DESTROY>LOG_ON_WAIT_FOR_DESTROY</a> or the proxy
destroys itself in this callback, the log on attempt will wait until the
current entity has logged off and then log on as normal. Note: The
calling code is still responsible for ensuring the current entity
is destroyed via <a href="Base.html">Base</a>.<a href=Base.html#destroy>destroy</a>. If the current entity has not been
destroyed within 5 seconds, the relogon attempt will be automatically
rejected.
</div>

<p>
<span class="function_parameter">参数：</span>
<table border=0 cellpadding=0 cellspacing=3 style="margin-left: 20px;">

<tr valign=top><td><span class="function_parameter_name"><i>ip</i></span></td><td><span class="function_parameter_description">&nbsp;The IP address of the client attempting to connect.
</span></td></tr>

<tr valign=top><td><span class="function_parameter_name"><i>port</i></span></td><td><span class="function_parameter_description">&nbsp;The port number of the client attempting to connect.
</span></td></tr>

<tr valign=top><td><span class="function_parameter_name"><i>password</i></span></td><td><span class="function_parameter_description">&nbsp;The password that the user attempted to log on with. This
argument is only present if the entity has a property called "password".
If the entity does not have a "password" property, onLogOnAttempt will be
called with only two arguments.
</span></td></tr>

</table>
</p>

<a name="onStreamComplete"></a><p class="function_definition">
<span class="function_definition">def onStreamComplete( <i>self, id, success</i> ):</span>
</p>

<div class="function_description">If present, this is called when a download to the attached client started
with either <a href="Proxy.html">Proxy</a>.<a href=Proxy.html#streamStringToClient>streamStringToClient</a>() or <a href="Proxy.html">Proxy</a>.<a href=Proxy.html#streamFileToClient>streamFileToClient</a>() has
terminated.
</div>

<p>
<span class="function_parameter">参数：</span>
<table border=0 cellpadding=0 cellspacing=3 style="margin-left: 20px;">

<tr valign=top><td><span class="function_parameter_name"><i>id</i></span></td><td><span class="function_parameter_description">&nbsp;The id of the terminated download.
</span></td></tr>

<tr valign=top><td><span class="function_parameter_name"><i>success</i></span></td><td><span class="function_parameter_description">&nbsp;Boolean indicating whether or not the download completed
                successfully.
</span></td></tr>

</table>
</p>

<hr>
<h2>属性文档</h2>

<a name="__account_name__"></a><p class="attribute_definition">
<span class="attribute_definition">__account_name__</span>
</p>

<div class="attribute_description">
<b>说明：</b><br><br>
如果proxy是账号则可以访问__account_name__得到帐号名。
</div>

<a name="clientAddr"></a><p class="attribute_definition">
<span class="attribute_definition">clientAddr</span>
</p>

<div class="attribute_description">This tuple contains the ip and port of the Client machine
</div>

<a name="entitiesEnabled"></a><p class="attribute_definition">
<span class="attribute_definition">entitiesEnabled</span>
</p>

<div class="attribute_description">This is whether or not entities have been enabled by the Client.
Scripts cannot communicate with the Client until it enables entities.
</div>

<a name="hasClient"></a><p class="attribute_definition">
<span class="attribute_definition">hasClient</span>
</p>

<div class="attribute_description">This is whether or not a client is currently attached to this <a href="Proxy.html">Proxy</a>.
</div>

<a name="latencyLast"></a><p class="attribute_definition">
<span class="attribute_definition">latencyLast</span>
</p>

<div class="attribute_description">This is the latency value that was used for the last check of the
latency triggers. It may be useful for initialising the state of
trigger call handlers when inserting their trigger value into the list.
</div>

<a name="latencyTriggers"></a><p class="attribute_definition">
<span class="attribute_definition">latencyTriggers</span>
</p>

<div class="attribute_description">This is a sequence of latency trigger values. Whenever the latency
passes this value in either direction, the onLatencyTrigger method
is called. The call is made with the relevant trigger value and
the direction (1 = above, 0 = below) as arguments. The latency is
checked roughly every second, but the calls occur in sorted order,
as if the latency value moved smoothly through its range. The latency
value used for this calculation is that of 'timeSinceHeardFromClient'.
</div>

<a name="roundTripTime"></a><p class="attribute_definition">
<span class="attribute_definition">roundTripTime</span>
</p>

<div class="attribute_description">This is the average round trip time in seconds for communication to the
client.
</div>

<a name="timeSinceHeardFromClient"></a><p class="attribute_definition">
<span class="attribute_definition">timeSinceHeardFromClient</span>
</p>

<div class="attribute_description">This is the number of seconds since a packet from the client was last
received.
</div>

<a name="wards"></a><p class="attribute_definition">
<span class="attribute_definition">wards</span>
</p>

<div class="attribute_description">This is a list of EntityIDs that the associated Client is allowed to control.  When controlEntity()
is called on the Client, the newly controlled Entity should be added to this list so the updates will
be propagated to the Cell, rather than the Cell updating the Client.
</div>

<hr>
<p class="copyrightFooter">版权归KBEngine所有。</p>
</body>
</html>
